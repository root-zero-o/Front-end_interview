# 스코프

## 1. 개념

- 모든 식별자는 ```자신이 선언된 위치```에 의해 다른 코드가 식별자 자신을 참조할 수 있는 유효 범위가 결정된다.

- 스코프는 ```식별자가 유효한 범위```를 말한다.
- JS엔진은 스코프를 통해 이름이 같은 두 개의 변수 중 어떤 변수를 참조할 것인지를 결정한다.(```식별자 결정```)

## 2. 종류
- 전역 스코프
    - 전역에 변수를 선언하면 전역 스코프를 갖는 전역 변수가 된다.
   
    - 전역 변수는 ```어디서든지 참조할 수 있다```.
- 지역 스코프
    - 지역(함수 몸체 내부)에 변수를 선언하면 지역 스코프를 갖는 지역 변수가 된다.(코드 블록이 아닌 함수에 의해서만 지역 스코프가 생성된다.)
    - 지역 변수는 자신의 지역 스코프와 하위 지역 스코프에서 유효하다.  
    
    - JS 엔진이 스코프 체인을 통해 참조할 변수를 검색했기 때문 !


## 3. 스코프 체인
- 함수가 중첩되면 스코프도 함수의 중첩에 의해 계층적 구조를 가진다.

- 스코프가 계층적으로 연결된 것을 ```스코프 체인```이라 한다.

![화면 캡처 2022-08-13 223012](https://user-images.githubusercontent.com/97326130/184496307-60aec4a7-cc41-4c85-9e31-b0bfd55ca02d.png)

- 변수를 참조할 때 JS 엔진은 스코프 체인을 통해 ```변수를 참조하는 코드의 스코프에서 시작```해 ```상위 스코프 방향으로 이동```하며 선언된 변수를 검색한다.

- JS엔진은 코드를 실행하기 전에 위 이미지와 유사한 자료구조인 ```렉시컬 환경(Lexical Environment)```을 실제로 생성한다.

- 변수 선언이 실행되면 변수 식별자가 이 자료구조(렉시컬 환경)에 키로 등록되고, 변수 할당이 일어나면 이 자료구조의 변수 식별자에 해당하는 값을 변경한다.

- 따라서 상위 스코프에서 유효한 변수는 하위 스코프에서 참조할 수 있으나, 하위 스코프에서 유효한 변수를 상위 스코프에서 참조할 수 없다.

## 4. 블록 레벨 스코프 vs 함수 레벨 스코프

- ```블록 레벨 스코프``` : 함수 몸체만이 아니라 모든 코드 블록(if, for, while, try/catch 등)이 지역 스코프를 만든다.(let, const)

- ```함수 레벨 스코프``` : 오로지 함수 몸체만을 지역 스코프로 인정한다.(var)

## 5. 동적 스코프 vs 정적 스코프

- ```동적 스코프``` : 함수를 어디서 호출했는지에 따라 함수의 상위 스코프를 결정한다.

- ```정적 스코프(렉시컬 스코프)``` : 함수를 어디서 정의했는지에 따라 함수의 상위 스코프를 결정한다.
- JS는 렉시컬 스코프를 따르므로, 함수를 어디서 정의했는지에 따라 상위 스코프를 결정한다.
- 함수의 상위 스코프는 함수 정의가 실행될 때 정적으로 결정되는데, 이 때 생성된 함수 객체는 결정된 상위 스코프를 기억한다.

```javascript
var x = 1;

function foo () {
  var x = 10;
  bar();
}

function bar(){  
  console.log(x);
}
// 전역에서 정의된 함수
// 함수 객체가 생성될 때 상위 스코프인 전역 스코프를 기억한다.
// bar 함수가 호출되면 호출된 위치에 관계없이 언제나 기억하고 있던 전역 스코프를 상위 스코프로 사용한다.

foo();
bar();
// 따라서 전역 변수 x의 값 1을 두 번 출력한다.
```

## 참고
- 모던 자바스크립트 Deep Dive
